# Subscriptions Service

Сервис для управления онлайн-подписками пользователей с CRUDL-операциями и подсчетом суммарной стоимости подписок за период.

---

## Оглавление

- [Описание](#описание)
- [Требования](#требования)
- [Установка и запуск](#установка-и-запуск)
- [Конфигурация](#конфигурация)
- [API](#api)
- [Миграции базы данных](#миграции-базы-данных)
- [Логи](#логи)
- [Swagger документация](#swagger-документация)

---

## Описание

Сервис предоставляет REST API для управления подписками пользователей. Каждая подписка содержит:

- Название сервиса
- Стоимость в рублях (целое число)
- ID пользователя (UUID)
- Дата начала подписки (месяц и год)
- Опциональная дата окончания подписки

---

## Требования

- Go 1.24+
- PostgreSQL
- Docker и Docker Compose

---

## Установка и запуск

1. Клонируйте репозиторий
   ```bash
   git clone <URL репозитория>  
   cd subscriptions
   ```

2. Заполните параметры подключения к базе данных в `.env` файле.

3. Запустите сервис с помощью Docker Compose:
   ```bash
   docker-compose up --build
   ```

4. Сервис будет доступен по адресу: `http://localhost:8080`

---

## Конфигурация

Конфигурация сервиса хранится в `.env` файле:
```env
APP_PORT=8080
DB_HOST=db
DB_PORT=5432
DB_USER=postgres
DB_PASSWORD=postgres
DB_NAME=subscriptions
```
---

## API
| Метод | URL                 | Описание                         |
|-------|---------------------|---------------------------------|
| POST  | `/subscriptions`    | Создать новую подписку           |
| GET   | `/subscriptions`    | Получить список подписок (фильтр по user_id и service_name) |
| GET   | `/subscriptions/:id`| Получить подписку по ID          |
| PUT   | `/subscriptions/:id`| Обновить подписку                |
| DELETE| `/subscriptions/:id`| Удалить подписку                 |
| GET   | `/subscriptions/total` | Подсчитать сумму подписок за период (с фильтрами) |

---

### Пример тела запроса на создание подписки
```json
{
  "service_name": "Yandex Plus",
  "price": 400,
  "user_id": "60601fee-2bf1-4721-ae6f-7636e79a0cba",
  "start_date": "07-2025"
}
```
---

## Миграции базы данных

Для управления миграциями используется [goose](https://github.com/pressly/goose).

Миграции автоматически применяются при старте сервиса.

Для ручного запуска миграций внутри контейнера:
```bash
docker-compose exec subscriptions goose up
```
---

## Логи

Логирование осуществляется с помощью [logrus](https://github.com/sirupsen/logrus).

Логи выводятся в консоль с уровнем `info` и выше.

---

## Swagger документация

Документация к API генерируется и доступна по адресу:

http://localhost:8080/swagger/index.html

---
